@using OnlineConsulting.Models.ViewModels.Pagination;
@model OnlineConsulting.Models.ViewModels.Chat.NewConversationListViewModel;

<h1 class="my-5">New conversations</h1>

@foreach (var conversation in Model.ConversationList)
{
    <div class="card mb-5">
        <div class="card-header d-flex justify-content-sm-between">
            <div class="d-flex align-items-center">
                <i class="fas fa-comment-alt fa-lg"></i>
                <h5 class="card-title m-0 ml-2 d-flex align-items-center">@conversation.Conversation.Host</h5>
            </div>
            <form asp-controller="chat" asp-action="consultant" method="post">
                @{
                    var ClientConnectionId = conversation.ConnectionId;
                    var RowVersion = conversation.RowVersion;
                }
                <input type="hidden" asp-for=@ClientConnectionId />
                <input type="hidden" asp-for=@RowVersion />
                <button class="btn btn-success">Join</button>
            </form>
        </div>
        <div class="card-body">
            <table class="table">
                <tbody>
                    <tr>
                        <th>Create date</th>
                        <td data-utc-date="@conversation.Conversation.CreateDate"></td>
                    </tr>
                    <tr>
                        <th>Origin</th>
                        <td>@conversation.Conversation.Host@conversation.Conversation.Path</td>
                    </tr>
                    <tr>
                        <th>Last message</th>
                        <td>@conversation.Conversation.LastMessage?.Content</td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
}

@await Html.PartialAsync(
    "/Views/Shared/Pagination/_Pagination.cshtml",
    new PaginationViewModel
    {
        PageIndex = Model.ConversationList.PageIndex,
        TotalPages = Model.ConversationList.TotalPages,
        HasPreviousPage = Model.ConversationList.HasPreviousPage,
        HasNextPage = Model.ConversationList.HasNextPage,
        SurroundingIndexes = Model.ConversationList.GetSurroundingIndexes(2),
        Action = "NewConversationList"
    })

@if (Model.Modal.ModalText != null)
{@await Html.PartialAsync("/Views/Shared/Modals/_Modal.cshtml", Model.Modal);
}

@section Scripts {
    <partial name="/Views/Shared/Scripts/_UtcToLocal.cshtml" />
}


